flowchart TD

%% ─── 1. WEB PATH: LEAD → REGISTRATION → PRE-CALL → MEETING
LANDING["Landing Page"]
LEAD_FORM["Lead Form (Eligibility Typeform)"]
WEB_REG["Registration + OTP + T&C"]
PRECALL_FORM["Pre-call Form"]
SCHEDULE_MEETING["Schedule GP (Calendly)"]
CONFIRM_MEETING["Confirm Meeting"]
CANCEL["Meeting Cancelled"]
GP_MEETING["GP Consultation"]
MARK_ELIG["Doctor marks patient eligible (Jet Admin)"]

%% Web path main flow
LANDING --> LEAD_FORM
LEAD_FORM --> WEB_REG
WEB_REG --> PRECALL_FORM
PRECALL_FORM --> SCHEDULE_MEETING
SCHEDULE_MEETING --> CONFIRM_MEETING
CONFIRM_MEETING -- yes --> GP_MEETING
CONFIRM_MEETING -- no --> CANCEL
GP_MEETING --> MARK_ELIG

%% After eligibility on web path
APP_INSTALL["App Install"]
APP_LOGIN["App Login"]
MARK_ELIG --> APP_INSTALL
APP_INSTALL --> APP_LOGIN

%% ─── PARALLEL APP PATH (can switch at any point)
APP_INSTALL_EARLY["App Install"]
APP_LOGIN_EARLY["App Login"]
COMPLETE_ONBOARDING_APP["Complete onboarding in App"]

%% Users can switch to app at any point
LANDING -.->|switch to app| APP_INSTALL_EARLY
LEAD_FORM -.->|switch to app| APP_INSTALL_EARLY
WEB_REG -.->|switch to app| APP_INSTALL_EARLY
PRECALL_FORM -.->|switch to app| APP_INSTALL_EARLY
SCHEDULE_MEETING -.->|switch to app| APP_INSTALL_EARLY

APP_INSTALL_EARLY --> APP_LOGIN_EARLY
APP_LOGIN_EARLY --> COMPLETE_ONBOARDING_APP

%% ─── 2. BOTH PATHS CONVERGE → SUBSCRIPTION
SHOW_SUBS["Eligibility appears in App"]
VOUCHER_MSG["Voucher & Subscription Prompt"]
CHOOSE_PLAN["User selects plan"]
STRIPE_PAYMENT["User pays via Stripe"]
SUBSCRIPTION_CREATED["Subscription Created"]
HOME["Home"]

%% Web path continues to eligibility
MARK_ELIG --> APP_INSTALL
APP_INSTALL --> APP_LOGIN
APP_LOGIN --> SHOW_SUBS

%% App path continues to eligibility (paths converge here)
COMPLETE_ONBOARDING_APP --> SHOW_SUBS

%% Continue subscription flow
SHOW_SUBS --> VOUCHER_MSG
VOUCHER_MSG --> CHOOSE_PLAN
CHOOSE_PLAN --> STRIPE_PAYMENT
STRIPE_PAYMENT --> SUBSCRIPTION_CREATED
SUBSCRIPTION_CREATED --> HOME

%% ─── 3. PRESCRIPTION & MEDICATION
CREATE_RX["Doctor creates Rx on Rempe"]
UPLOAD_RX["Doctor uploads Rx to Jet Admin"]
PRESC_VISIBLE["Prescription visible in App"]
PRESC_NOTIFY["User notified (email + push)"]

SUBSCRIPTION_CREATED --> CREATE_RX
CREATE_RX --> UPLOAD_RX
UPLOAD_RX --> PRESC_VISIBLE
UPLOAD_RX --> PRESC_NOTIFY

%% ─── 4. INJECTION + SYMPTOMS + FOLLOW-UP
INJECTION["User takes injection"]
REMINDER["Injection reminder"]
WEIGHT["User logs weight"]
SYMPTOMS["User logs symptoms"]
FOLLOWUP["GP follows up (video or chat)"]

PRESC_VISIBLE --> INJECTION
INJECTION --> WEIGHT
INJECTION --> SYMPTOMS
SYMPTOMS --> FOLLOWUP
INJECTION -- missed --> REMINDER
REMINDER --> INJECTION

%% ─── 5. NUTRITION MODULE (from Home when subscription active)
FILL_NUTRI_FORM["User completes Nutrition Form"]
NT_SESSION["Nutritionist session"]
NT_PLAN["Personalized nutrition plan"]
NT_FOLLOWUP["Nutritionist follow-up"]
CONTINUE_MED["Patient continues treatment"]

HOME -->|sub active| FILL_NUTRI_FORM
FILL_NUTRI_FORM --> NT_SESSION
NT_SESSION --> NT_PLAN
NT_PLAN --> NT_FOLLOWUP
NT_FOLLOWUP --> CONTINUE_MED

%% ─── 6. PERSONAL TRAINER MODULE (from Home when subscription active)
PT_FORM["User completes PT intake form"]
PT_SESSION["PT session"]
PT_PLAN["Personalized PT plan"]
PT_FOLLOWUP["PT follow-up"]

HOME -->|sub active| PT_FORM
PT_FORM --> PT_SESSION
PT_SESSION --> PT_PLAN
PT_PLAN --> PT_FOLLOWUP
PT_FOLLOWUP --> CONTINUE_MED

%% ─── 7. RETENTION LOOP
NPS["User gives feedback (NPS)"]
NEW_RX["Doctor uploads new month Rx"]

FOLLOWUP --> NPS
NT_FOLLOWUP --> NPS
PT_FOLLOWUP --> NPS
NPS --> NEW_RX
NEW_RX --> CONTINUE_MED